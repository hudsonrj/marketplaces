generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["marketplaces"]
}

model Product {
  id                String      @id @default(uuid())
  name              String
  description       String?
  costPrice         Decimal     @map("cost_price")
  weight            Float?
  dimensions        String?
  originCep         String?     @map("origin_cep")
  category          String?
  brand             String?
  imageUrl          String?     @map("image_url")
  active            Boolean     @default(true)
  createdAt         DateTime    @default(now()) @map("created_at")
  updatedAt         DateTime    @updatedAt @map("updated_at")
  lastBestPrice     Decimal?    @map("last_best_price")
  lastBestPriceDate DateTime?   @map("last_best_price_date")
  searchJobs        SearchJob[]

  @@schema("marketplaces")
}

model SearchJob {
  id           String         @id @default(uuid())
  productId    String         @map("product_id")
  status       String
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  scheduledFor DateTime?      @map("scheduled_for")
  progress     Int            @default(0)
  logs         Json?
  product      Product        @relation(fields: [productId], references: [id])
  results      SearchResult[]

  @@schema("marketplaces")
}

model SearchResult {
  id             String    @id @default(uuid())
  jobId          String    @map("job_id")
  marketplace    String
  title          String
  price          Decimal
  shipping       Decimal?
  link           String
  sellerName     String?   @map("seller_name")
  sellerLocation String?   @map("seller_location")
  sellerRating   String?   @map("seller_rating")
  imageUrl       String?   @map("image_url")
  matchScore     Int?      @map("match_score")
  matchReasoning String?   @map("match_reasoning")
  normalizedName String?   @map("normalized_name")
  city           String?
  state          String?
  installments   String?
  quantitySold   String?   @map("quantity_sold")
  reviewScore    String?   @map("review_score")
  condition      String?   @default("new")
  collectedAt    DateTime  @default(now()) @map("collected_at")
  job            SearchJob @relation(fields: [jobId], references: [id])

  @@schema("marketplaces")
}

model Settings {
  id         String   @id @default(uuid())
  aiProvider String   @default("openai")
  aiModel    String   @default("gpt-4o-mini")
  aiApiKey   String   @default("")
  proxyUrl   String?  @default("")
  updatedAt  DateTime @updatedAt

  @@schema("marketplaces")
}
